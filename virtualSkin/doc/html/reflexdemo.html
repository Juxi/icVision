<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>VirtualSkin: Reflex Demo Tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.2 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="reflexdemo">Reflex Demo Tutorial </a></h1><p>In this tutorial we will run the Reflex Demonstration in conjunction with the iCub Simulator.</p>
<h2><a class="anchor" id="yarp">
YARP</a></h2>
<p>Start your YARP server somewhere on the network (can also be on the local machine where you intend to run Virtual Skin) </p>
<div class="fragment"><pre class="fragment">yarp server </pre></div><p>Make sure each machine you intend to use in your experiment can see it </p>
<div class="fragment"><pre class="fragment">yarp where </pre></div><p>If you do not see the IP address of the machine running your YARP server, try: </p>
<div class="fragment"><pre class="fragment">yarp detect --write </pre></div><p> For more help on YARP, read the <a href="http://eris.liralab.it/yarpdoc/index.html">YARP documentation</a>.</p>
<h2><a class="anchor" id="sim">
iCub Simulator</a></h2>
<p>Start the simulator </p>
<div class="fragment"><pre class="fragment">cd YOUR_ICUB_REPOSITORY_ROOT_DIR/main/bin </pre></div> <div class="fragment"><pre class="fragment">./iCub_SIM </pre></div><p> For more help, read the <a href="http://eris.liralab.it/wiki/ODE">iCub Simulator Installation guide</a> and <a href="http://eris.liralab.it/wiki/Simulator_README">iCub Simulator README</a>.</p>
<p>Home the robot using the robotMotorGui: </p>
<div class="fragment"><pre class="fragment">cd YOUR_ICUB_REPOSITORY_ROOT_DIR/main/bin </pre></div> <div class="fragment"><pre class="fragment">./robotMotorGui </pre></div><p>In the GUI, do the following:</p>
<ul>
<li>Uncheck 'leftleg' and 'rightleg'</li>
<li>Enter <code>icubSim</code> in the textbox and click the button</li>
<li>At the top of the robotMotorGui window, click the tab labeled 'all'</li>
<li>Click the button 'Home ALL Parts'</li>
</ul>
<p>The robot should move to the home position.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>If you forget to do this, there will be collisions when you start the reflex demonstration. This is desirable behavior, as we have provided a very conservative robot model with very large bounding volumes around the iCub's body parts.</dd></dl>
<h2><a class="anchor" id="skin">
Reflex Demo</a></h2>
<p>The following commands assume that you have compiled the source code in the directory <code>YOUR_LOCAL_GIT_REPOSITORY/virtualSkin/build</code>, that you have run <code>make</code> then <code>make</code> <code>install</code> in that directory, and that you have not modified the directory <code>YOUR_LOCAL_GIT_REPOSITORY/virtualSkin/xml</code> or its contents.</p>
<p>Start the Reflex demonstration: </p>
<div class="fragment"><pre class="fragment">cd YOUR_LOCAL_GIT_REPOSITORY/virtualSkin/bin </pre></div> <div class="fragment"><pre class="fragment">./reflex --visualize --file ../xml/iCubSim.xml </pre></div><dl class="note"><dt><b>Note:</b></dt><dd>If the <code>reflex</code> command returns 'device not found' errors, check that ports associated with the robot name in your XML file are actually available on the network.</dd>
<dd>
If you were to use '--file ../xml/iCub.xml' you would connect to the real iCub hardware.</dd></dl>
<p>Now you should see a window pop up with a model of the iCub upper-body in it. Read the output in the console. You have just created the following YARP ports:</p>
<ul>
<li>/icubSimF/torso/command:i</li>
<li>/icubSimF/torso/state:i</li>
<li>/icubSimF/torso/rpc:i</li>
<li>/icubSimF/head/command:i</li>
<li>/icubSimF/head/state:i</li>
<li>/icubSimF/head/rpc:i</li>
<li>/icubSimF/right_arm/command:i</li>
<li>/icubSimF/right_arm/state:i</li>
<li>/icubSimF/right_arm/rpc:i</li>
<li>/icubSimF/left_arm/command:i</li>
<li>/icubSimF/left_arm/state:i</li>
<li>/icubSimF/left_arm/rpc:i</li>
</ul>
<p>These are filtered ports (designated by the "F" at the end of the robot name), which forward information to and from their counterparts, the ports with similar names but no "F", which are associated with the hardware or simulator. The robot models provided with this distribution of Virtual Skin (in this case '../xml/iCubSim.xml') include only the iCub's upper body. Therefore, filters are only created for the control boards: <code>torso</code>, <code>head</code>, <code>left_arm</code> and <code>right_arm</code>. For more info on the YarpFilter, check out <a class="el" href="filter.html">YARP Filter Detail</a>.</p>
<p>Connecting your control program to these filtered ports will prevent the robot from colliding with itself or with objects modeled in the environment. Control commands will only be forwarded when the robot model (librobotModel.a) is in a safe configuration. As soon as the robot model is in a colliding configuration, the filter is cut, meaning filtered ports no longer forward incoming control commands (libyarpFilter.a). Because the bounding volumes of the robot model are somewhat larger than the actual parts they envelop, detected collision events precede actual physical collisions. <a href="">ELABORATE ON NO GUARANTEES</a></p>
<dl class="note"><dt><b>Note:</b></dt><dd><ul>
<li>The files <code>YOUR_LOCAL_GIT_REPOSITORY/virtualSkin/xml/iCub.xml</code> and <code>YOUR_LOCAL_GIT_REPOSITORY/virtualSkin/xml/iCubSim.xml</code> are exactly the same except for the robot name, and the kinematics and geometry therein reflect the real iCub hardware. The simulator is quite a bit different from the real iCub, so when you run the above demonstration, it will not effectively prevent the simulated iCub from colliding with itself.</li>
<li>Since the filtered ports provide transparent access to the underlying YARP ControlBoardInterface, control programs in the iCub repository can easily operate through the ControlBoardFilter. For example, try connecting <code>robotMotorGui</code> to the filtered ports by specifying the robot name 'icubSimF'. Remember not to connect to the legs, as there are no filtered ports <code>/icubSimF/left_leg/*</code> and <code>/icubSimF/right_leg/*</code>. One caveat here is that programs in the repository may behave strangely when the filter is cut, as position move and velocity move commands (from YARP's IPositionControl and IVelocityControl interfaces) will return <code>false</code> during that time.</li>
</ul>
</dd></dl>
<p>In addition to cutting off the client's control of the robot, in the Reflex Demo, collision events trigger a reflexive behavior to return the robot to a previous safe configuration. Only when the robot has reached this safe pose do the filtered ports begin to forward the client's control commands again.</p>
<p>See <a class="el" href="reflexports.html">Reflex Demo - YARP Ports</a> for names and descriptions of several additional ports that may prove useful for your control programs.</p>
<h2><a class="anchor" id="babbler">
iCubBabbler</a></h2>
<p>In order to try out the Reflex Demo...</p>
<p>Start the iCubBabbler: </p>
<div class="fragment"><pre class="fragment">cd YOUR_LOCAL_GIT_REPOSITORY/virtualSkin/bin </pre></div> <div class="fragment"><pre class="fragment">./iCubBabble --robot icubSimF [--type position | velocity] [--period (float seconds)] [--speed (float)] [--hands] </pre></div><dl class="note"><dt><b>Note:</b></dt><dd>If you use the babbler with a real robot, make sure that you ALWAYS connect it to ports filtered by Virtual Skin. If you connect the babbler directly to a robot (by specifying "--robot icub") you WILL cause the robot to collide violently with itself or surrounding objects.</dd></dl>
<p>Watch the simulated iCub move around randomly and bump into himself. When collision events occur, the involved geometries turn red in the robot model visualization, the filtered ports stop forwarding control commands and the reflex behavior is executed. The iCubBabbler does not know anything about the state of the robot. It simply sees that its control commands fail during certain time intervals.</p>
<p>In velocity babbling mode, successful (forwarded) commands are represented as "." whereas failed (unforwarded or ignored) commands are represented as "x" in the terminal output. Similarly, in position babbling mode a ":-)" following the command indicates success whereas a ":-(" indicates failure.</p>
<p>A few words on the command line options:</p>
<ul>
<li><b>--robot</b> is followed by the name of the robot (ports) you want to connect to. This will be <code>icubF</code>, <code>icubSimF</code> or <code>icubSim</code>. If you connect the babbler to <code>icub</code>, you WILL crash the robot.</li>
<li><b>--type</b> is followed by <code>position</code> or <code>velocity</code>, which indicates whether the babbler should send position or velocity control commands. If omitted, velocity commands will be sent by default.</li>
<li><b>--period</b> is followed by a floating point number of seconds, the time babbler waits between random commands.</li>
<li><b>--speed</b> controls the maximum speed of the random motions. The babbler does not check for limits as they are not available through YARP's iVelocityControl interface.</li>
<li><b>--hands</b> controls whether the thumb and fingers are also moved during babbling.</li>
</ul>
<p>2011-01-01, Kail Frank - <a href="mailto:kail@idsia.ch">kail@idsia.ch</a> </p>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.2 </small></address>
</body>
</html>
